# 平衡二分探索木 (AVL木)

## 概要

C++のset、欲しい.............

## 何ができる？
  
空で初期化された集合に対して、以下の操作がO(logN)程度の時間計算量で
行える (Nは要素数)

- 値 x を追加する (add)
- 値 x を削除する 存在しない場合は特に変化なし (delete)
- 値 x が存在するかを確かめる (find)
- k 番目に小さい値を取得する k > 要素数の場合, INF (kth)

以下 TODO 
- nより (小さな最大の | 大きな最小の) 要素を返却する (upper_bound/lower_bound)


なお、ここは実装によって別れるところだが、既に存在する値が入った場合は上書きせず、二つ、三つ... としてカウントしている  
(これは多重集合というっぽい ちょうど最近 https://kimiyuki.net/blog/2020/11/03/set-sequence-multiset/ という文書が公開された)


### 実装のメモ(はしりがき)

Nodeに親を持たせるのではなく、自分自身をrootとした部分AVL木を調整してから return new_root (?)

- 後から見て言いたいこと伝わるかな？
最初の実装では、調整した結果を親の左につけるか右につけるかで場合分けが生じたので、人の実装を見てこの方法に落ち着いた

回転フラグの管理方法  
全てのノードに明示的にheight, biasを持たせるようにした プロパティの参照をいちいちしすぎな気がしていて、もっと定数倍が軽いような実装がありそう

- どうやら下から更新フラグ(bool)を伝播させていくような方法もあるらしい？
でもこの方法でも結局heightは管理する必要がありそうだが...
明確にいい点として、falseになったところで打ち切れる。現在の実装だと必ずrootまで戻らなければならない

### がんばった
非再帰化 (またですか？)  
遅延セグ木が特殊な場合でAVL木は非再帰にするの難しい... と思っていたが、どうやらstackがかなり便利だということに気づいてきた

### 実装に当たって参考にしたものなど
https://www.slideshare.net/iwiwi/2-12188757  

https://stnkien.hatenablog.com/entry/avl-tree

http://wwwa.pikara.ne.jp/okojisan/avl-tree/index.html

## verify 
https://atcoder.jp/contests/arc033/submissions/17878661 (add, delete および kth smallest)

## テストを書く
...